title: 解释“闭包”需要几行代码？
date: 2013-06-16 12:21:53
comments: true
categories: 编程
tags: [closure, 对象, JavaScript]
---

关于什么是闭包，很多“高手”会给出一段“特权函数”访问外部作用域变量的 JavaScript 代码，并且告诉你，闭包就是局部变量在函数返回之后继续存在。

那么，你如何理解“闭包是穷人的对象”、“对象是穷人的闭包”？

往下看，你会明白，用代码解释闭包的“高手”与“砖家”没有什么不同。
<!--more-->

===========================================================

*以下内容根据《代码的未来》、“犀牛书”、以及《Thinking in Java》整理

===========================================================

### 什么是闭包？

闭包（Closure）这个词的意思是封闭，将外部作用域中的局部变量封闭起来的函数对象称为闭包。被封闭起来的变量与封闭它的函数对象有相同的生命周期。

### 什么是函数对象？

函数对象是作为对象来使用的函数，这里的对象是指编程语言操作的数据。

### 函数对象与闭包

函数对象不一定是闭包。

C 语言中，可以获取一个函数的指针，并通过指针间接调用此函数。这就是 C 语言中的对象（函数对象也是对象）。但 C 语言中的函数对象不是闭包——它不能访问外部作用域的局部变量。

Javascript 中，每个函数都有一个与之相关联的作用域链。每次调用 JavaScript 函数的时候，都会为之创建一个新的对象用来保存局部变量，并把这个对象添加至作用域链中。当函数返回时，再将这个对象删除，此对象会被当做垃圾回收。但如果这个函数定义了嵌套的函数，并将它存储在某处的属性里，就意味着有了一个外部引用指向这个嵌套的函数。它就不会被当作垃圾回收，它所指向的变量绑定对象同样不会被回收。

由此可见，JavaScript 中的函数对象是闭包——可以把外部作用域的局部变量“封闭”起来。

### 什么是对象？

面向对象中的“对象”是指问题空间中的元素（猫、狗）及其在解空间中的表示（new Cat(); new Dog()）。对象是过程（函数）与数据的结合。

### 对象与闭包

对象是在数据中以方法的形式内含了过程，闭包是在过程中以环境的形式内含了数据。所谓“闭包是穷人的对象”、“对象是穷人的闭包”，就是说使用其中的一种方式，就能实现另一种方式能够实现的功能。

### 应用场景

保护函数内的变量安全：如迭代器、生成器。
在内存中维持变量：如缓存数据、柯里化。

### 砖家的错误

看到了吧，解释闭包，一行代码都不需要。“闭包”是一个概念，不是编程技巧，不应该用代码解释闭包！



